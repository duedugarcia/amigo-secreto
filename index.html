<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ„ Amigo Secreto da FamÃ­lia</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Poppins,sans-serif;min-height:100vh;background:linear-gradient(135deg,#0f5132,#198754);display:flex;align-items:center;justify-content:center}
.card{background:#fff;color:#333;width:100%;max-width:540px;padding:30px;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.25)}
h1{text-align:center;margin-bottom:10px}
.subtitle{text-align:center;color:#666;font-size:14px;margin-bottom:20px}
label{font-size:14px;font-weight:500}
input,select,textarea{width:100%;padding:12px;margin:8px 0 14px;border-radius:8px;border:1px solid #ccc}
button{width:100%;padding:12px;border:none;border-radius:8px;background:#198754;color:#fff;font-weight:600;cursor:pointer}
button:hover{background:#146c43}
.secondary{background:#6c757d;margin-top:8px}
.secondary:hover{background:#565e64}
.danger{background:#dc3545;margin-top:8px}
.danger:hover{background:#bb2d3b}
.hidden{display:none}
.eye{cursor:pointer;font-size:14px;text-align:right;color:#198754}
.table{width:100%;border-collapse:collapse;font-size:13px;margin-top:10px}
.table th,.table td{border-bottom:1px solid #ddd;padding:6px;text-align:left}
.table th{background:#f1f1f1}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal-content{background:#fff;padding:25px;border-radius:16px;width:90%;max-width:420px}
.result{text-align:center;font-size:18px}
.result span{display:block;font-size:26px;color:#198754;font-weight:600}
</style>
</head>
<body>

<div class="card">

<!-- CADASTRO -->
<div id="telaCadastro">
<h1>ğŸ Amigo Secreto</h1>
<p class="subtitle" id="cadastroInfo">Cadastro de Participantes - Desenvolvido Por TioZÃ©</p>
<label>Nome</label>
<input id="nome">
<label>E-mail</label>
<input id="email" type="email">
<label>Senha</label>
<input id="senha" type="password">
<div class="eye" onclick="toggleSenha()">ğŸ‘ Mostrar / Ocultar senha</div>
<button id="btnCadastro" onclick="cadastrar()">Entrar no sorteio</button>
<button id="btnLogin" class="secondary" onclick="mostrarTela('telaLogin')">JÃ¡ me cadastrei</button>
<button class="secondary" onclick="mostrarTela('telaAdminLogin')">Ãrea do administrador</button>
</div>

<!-- LOGIN PARTICIPANTE -->
<div id="telaLogin" class="hidden">
<h1>ğŸ” Login</h1>
<input id="loginEmail" placeholder="E-mail">
<input id="loginSenha" type="password" placeholder="Senha">
<button id="btnVer" onclick="verResultado()">Ver meu Amigo Secreto</button>
<button class="secondary" onclick="mostrarTela('telaCadastro')">Voltar</button>
</div>

<!-- RESULTADO -->
<div id="telaResultado" class="hidden">
<h1>ğŸ„ Resultado</h1>
<div class="result" id="resultado"></div>
<button onclick="exportarPDF()">ğŸ“„ Exportar em PDF</button>
<button class="secondary" onclick="mostrarTela('telaCadastro')">Sair</button>
</div>
<button class="secondary" onclick="mostrarTela('telaCadastro')">Sair</button>
</div>

<!-- ADMIN LOGIN -->
<div id="telaAdminLogin" class="hidden">
<h1>ğŸ› ï¸ Administrador</h1>
<input id="adminSenha" type="password" placeholder="Senha do admin">
<button onclick="loginAdmin()">Entrar</button>
<button class="secondary" onclick="mostrarTela('telaCadastro')">Voltar</button>
</div>

<!-- ADMIN PAINEL -->
<div id="telaAdmin" class="hidden">
<h1>âš™ï¸ Painel Admin</h1>
<p class="subtitle" id="infoAdmin"></p>
<button onclick="forcarSorteio()">Encerrar cadastros e sortear</button>
<table class="table" id="tabela"></table>
<button class="danger" onclick="resetarTudo()">Resetar tudo</button>
<button class="secondary" onclick="mostrarTela('telaCadastro')">Sair</button>
</div>

</div>

<!-- MODAL PREFERÃŠNCIAS -->
<div class="modal" id="modalPreferencias">
<div class="modal-content">
<h2>ğŸ PreferÃªncias</h2>
<label>O que gostaria de ganhar?</label>
<textarea id="prefPresente"></textarea>
<label>NÂº do calÃ§ado</label>
<input id="prefCalcado">
<label>Tamanho da roupa</label>
<select id="prefRoupa"><option value="">Selecione</option><option>P</option><option>M</option><option>G</option><option>GG</option></select>
<label>Outros detalhes</label>
<textarea id="prefOutros"></textarea>
<button onclick="salvarPreferencias()">Salvar preferÃªncias</button>
</div>
</div>

<script>
const KEY_P='as_part';
const KEY_S='as_sort';
const KEY_B='as_block';
const ADMIN_SENHA='admin123';
let tempCadastro=null;

const getP=()=>JSON.parse(localStorage.getItem(KEY_P))||[];
const saveP=l=>localStorage.setItem(KEY_P,JSON.stringify(l));
const hash=s=>btoa(s);

function mostrarTela(id){document.querySelectorAll('.card>div').forEach(d=>d.classList.add('hidden'));document.getElementById(id).classList.remove('hidden')}

function toggleSenha(){const s=document.getElementById('senha');s.type=s.type==='password'?'text':'password'}

function cadastrar(){
 if(localStorage.getItem(KEY_B))return alert('Cadastros encerrados');
 const nome=document.getElementById('nome').value.trim();
 const email=document.getElementById('email').value.trim().toLowerCase();
 const senha=document.getElementById('senha').value;
 if(!nome||!email||!senha)return alert('Preencha todos os campos');
 if(getP().find(p=>p.email===email))return alert('E-mail jÃ¡ cadastrado');
 tempCadastro={nome,email,senha:hash(senha),revelado:false};
 document.getElementById('modalPreferencias').style.display='flex';
}

function salvarPreferencias(){
 const lista=getP();
 tempCadastro.preferencias={presente:prefPresente.value,calcado:prefCalcado.value,roupa:prefRoupa.value,outros:prefOutros.value};
 lista.push(tempCadastro);saveP(lista);
 tempCadastro=null;
 document.getElementById('modalPreferencias').style.display='none';
 alert('Cadastro concluÃ­do ğŸ„');
 nome.value=email.value=senha.value=prefPresente.value=prefCalcado.value=prefRoupa.value=prefOutros.value='';
}

function sortear(){if(localStorage.getItem(KEY_S))return;const p=getP();if(p.length<2)return;let s;do{s=[...p].sort(()=>Math.random()-.5)}while(s.some((x,i)=>x.email===p[i].email));localStorage.setItem(KEY_S,JSON.stringify(p.map((x,i)=>({...x,sorteado:s[i].nome}))));}

function verResultado(){if(!localStorage.getItem(KEY_S))return alert('Sorteio ainda nÃ£o iniciado');const e=loginEmail.value.toLowerCase();const s=hash(loginSenha.value);const r=JSON.parse(localStorage.getItem(KEY_S))||[];const p=r.find(x=>x.email===e&&x.senha===s);if(!p)return alert('Credenciais invÃ¡lidas');p.revelado=true;localStorage.setItem(KEY_S,JSON.stringify(r));resultado.innerHTML=`ğŸ OlÃ¡ <b>${p.nome}</b><span>ğŸ„ ${p.sorteado}</span><p><b>Dicas:</b><br>${p.preferencias.presente}<br>ğŸ‘Ÿ ${p.preferencias.calcado} | ğŸ‘• ${p.preferencias.roupa}<br>${p.preferencias.outros}</p>`;mostrarTela('telaResultado')}

function loginAdmin(){if(adminSenha.value!==ADMIN_SENHA)return alert('Senha incorreta');atualizarAdmin();mostrarTela('telaAdmin')}

function atualizarAdmin(){const p=getP();infoAdmin.innerText=`Participantes: ${p.length}`;let h='<tr><th>Nome</th><th>Email</th><th>Revelado</th></tr>';p.forEach(x=>h+=`<tr><td>${x.nome}</td><td>${x.email}</td><td>${x.revelado?'âœ…':'â³'}</td></tr>`);tabela.innerHTML=h}

function forcarSorteio(){localStorage.setItem(KEY_B,'1');localStorage.removeItem(KEY_S);sortear();alert('Sorteio iniciado');}
function resetarTudo(){if(confirm('Tem certeza?')){localStorage.clear();location.reload();}}


function exportarPDF(){
  if(typeof window.jspdf === 'undefined') return alert('Biblioteca PDF nÃ£o carregada');
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const texto = document.getElementById('resultado').innerText;

  doc.setFont('helvetica','normal');
  doc.setFontSize(14);
  doc.text('ğŸ Amigo Secreto', 20, 20);
  doc.setFontSize(11);
  doc.text(texto, 20, 35, { maxWidth: 170 });

  doc.save('meu-amigo-secreto.pdf');
}
</script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</body>
</html>
